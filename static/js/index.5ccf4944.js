(()=>{"use strict";var e={9427:function(e,t,r){let n,o;var a,i=r("1549"),s=r("4194"),c=r("8082");class l extends Error{constructor(e){super(e),this.name="IDBCacheError",Object.setPrototypeOf(this,new.target.prototype)}}class d extends l{constructor(e){super(e),this.name="DatabaseError"}}class u extends l{constructor(e){super(e),this.name="CryptoError"}}class h extends l{constructor(e){super(e),this.name="WorkerInitializationError"}}class m extends l{constructor(e){super(e),this.name="EncryptionError"}}class f extends l{constructor(e){super(e),this.name="DecryptionError"}}class p extends l{constructor(e){super(e),this.name="TimeoutError"}}function w(e,t){e.forEach((r,n)=>{r.reject(new h(t)),clearTimeout(r.timer),e.delete(n)})}async function y(e,t,r,n,o,a=5e3){return new Promise((i,s)=>{let c=setTimeout(()=>{let e=n.get(t);e&&(e.reject(new p("Request timed out")),n.delete(t))},a);n.set(t,{resolve:i,reject:s,timer:c});let l=[];o&&o.length>0&&l.push(...o);try{l.length>0?e.postMessage(r,l):e.postMessage(r)}catch(r){console.error("Failed to post message to worker:",r);let e=n.get(t);e&&(clearTimeout(e.timer),e.reject(new h("Failed to communicate with the worker.")),n.delete(t));return}})}async function g(e,t,r){let n=crypto.randomUUID();try{return await y(e,n,{requestId:n,type:"encrypt",payload:{value:t}},r,[],5e3)}catch(e){if(e instanceof h||e instanceof m||e instanceof l)throw e;throw new m(e instanceof Error?e.message:"Unknown encryption error")}}async function x(e,t,r,n){let o=crypto.randomUUID();try{return await y(e,o,{requestId:o,type:"decrypt",payload:{iv:t,ciphertext:r}},n,[t,r],5e3)}catch(e){if(e instanceof h||e instanceof f||e instanceof l)throw e;throw new f(e instanceof Error?e.message:"Unknown decryption error")}}let b=(e,t)=>t.some(t=>e instanceof t),k=new WeakMap,j=new WeakMap,v=new WeakMap,I={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return k.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return S(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function C(e){I=e(I)}function S(e){if(e instanceof IDBRequest)return function(e){let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",a)},o=()=>{t(S(e.result)),n()},a=()=>{r(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",a)});return v.set(t,e),t}(e);if(j.has(e))return j.get(e);let t=function(e){if("function"==typeof e){var t;return t=e,(o||(o=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(E(this),e),S(this.request)}:function(...e){return S(t.apply(E(this),e))}}return(e instanceof IDBTransaction&&!function(e){if(k.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",a),e.removeEventListener("abort",a)},o=()=>{t(),n()},a=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",o),e.addEventListener("error",a),e.addEventListener("abort",a)});k.set(e,t)}(e),b(e,n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,I):e}(e);return t!==e&&(j.set(e,t),v.set(t,e)),t}let E=e=>v.get(e);function B(e,t,{blocked:r,upgrade:n,blocking:o,terminated:a}={}){let i=indexedDB.open(e,t),s=S(i);return n&&i.addEventListener("upgradeneeded",e=>{n(S(i.result),e.oldVersion,e.newVersion,S(i.transaction),e)}),r&&i.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),s.then(e=>{a&&e.addEventListener("close",()=>a()),o&&e.addEventListener("versionchange",e=>o(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}let D=["get","getKey","getAll","getAllKeys","count"],M=["put","add","delete","clear"],$=new Map;function z(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if($.get(t))return $.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,o=M.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(o||D.includes(r)))return;let a=async function(e,...t){let a=this.transaction(e,o?"readwrite":"readonly"),i=a.store;return n&&(i=i.index(t.shift())),(await Promise.all([i[r](...t),o&&a.done]))[0]};return $.set(t,a),a}I=(e=>({...e,get:(t,r,n)=>z(t,r)||e.get(t,r,n),has:(t,r)=>!!z(t,r)||e.has(t,r)}))(I);let P=["continue","continuePrimaryKey","advance"],R={},T=new WeakMap,L=new WeakMap,W={get(e,t){if(!P.includes(t))return e[t];let r=R[t];return!r&&(r=R[t]=function(...e){T.set(this,L.get(this)[t](...e))}),r}};async function*O(...e){let t=this;if(!(t instanceof IDBCursor)&&(t=await t.openCursor(...e)),!t)return;let r=new Proxy(t,W);for(L.set(r,t),v.set(r,E(t));t;)yield r,t=await (T.get(r)||t.continue()),T.delete(r)}function N(e,t){return t===Symbol.asyncIterator&&b(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&b(e,[IDBIndex,IDBObjectStore])}I=(e=>({...e,get:(t,r,n)=>N(t,r)?O:e.get(t,r,n),has:(t,r)=>N(t,r)||e.has(t,r)}))(I);let U=new Map;async function K(e){var t;if(U.has(e)){let t=U.get(e);if("string"==typeof t)return t}let r=new TextEncoder().encode(e);let n=[(t=Array.from(new Uint8Array(await crypto.subtle.digest("SHA-512",r))).map(e=>e.toString(16).padStart(2,"0")).join("")).slice(0,8),t.slice(8,12),`4${t.slice(13,16)}`,(3&Number.parseInt(t.slice(16,17),16)|8).toString(16)+t.slice(17,20),t.slice(20,32)].join("-");return U.set(e,n),n}async function A(e,t,r){let n=[],o=e.transaction(t,"readonly"),a=o.store,i=`${r}-chunk-000000-`,s=`${r}-chunk-999999\uffff`,c=IDBKeyRange.bound(i,s,!1,!1),l=await a.openKeyCursor(c);for(;l;)n.push(l.key),l=await l.continue();return await o.done,n}function V(e,t){if(!e.objectStoreNames.contains(t)){let r=e.createObjectStore(t,{keyPath:"key"});r.createIndex("byTimestamp","timestamp"),r.createIndex("byCacheBuster","cacheBuster")}}async function G(e,t,r){try{return await B(e,r,{upgrade(e){V(e,t)}})}catch(n){if(n instanceof DOMException&&"VersionError"===n.name)return console.warn(`VersionError: Deleting database ${e} and retrying...`),await function(e,{blocked:t}={}){let r=indexedDB.deleteDatabase(e);return t&&r.addEventListener("blocked",e=>t(e.oldVersion,e)),S(r).then(()=>void 0)}(e),await B(e,r,{upgrade(e){V(e,t)}});throw n}}function F(){let e=null,t=new Map,r=1e5,n=null,o=null;async function a(e){if(!o)throw Error("Fixed salt (cacheBuster) not initialized");let n=`${new TextDecoder().decode(e)}-${new TextDecoder().decode(new Uint8Array(o))}`;if(t.has(n)){let e=t.get(n);if(void 0!==e)return e}let a=await crypto.subtle.importKey("raw",e,{name:"PBKDF2"},!1,["deriveKey"]),i=await crypto.subtle.deriveKey({name:"PBKDF2",salt:o,iterations:r,hash:"SHA-512"},a,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]);return t.set(n,i),i}async function i(){if(!e)throw Error("Cache key not provided for encryption worker");try{null==n||n.postMessage({type:"ready"})}catch(t){console.error("Worker: Failed to initialize AES key:",t);let e=t instanceof Error?t.message:"Unknown initialization error";null==n||n.postMessage({type:"initError",error:e})}}async function s(t){if(!e)throw Error("Cache key not initialized");if(!o)throw Error("Fixed salt (cacheBuster) not initialized");let r=crypto.getRandomValues(new Uint8Array(12)),n=new TextEncoder,i=await a(e),s=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},i,n.encode(t));return{iv:r.buffer,ciphertext:s}}async function c(t,r){if(!e)throw Error("AES key not initialized");if(!o)throw Error("Fixed salt (cacheBuster) not initialized");let n=new Uint8Array(t),i=await a(e),s=await crypto.subtle.decrypt({name:"AES-GCM",iv:n},i,r);return new TextDecoder().decode(s)}let l=[],d=1,u=0;function h(e){l.push(e),m()}async function m(){for(;u<d&&l.length>0;){let e=l.shift();e&&(u++,(async()=>{let t=performance.now();try{await e()}catch(e){console.error("Worker: Task execution error:",e)}finally{(function(e){e<40&&d<10?d++:e>80&&d>1&&d--})(performance.now()-t),u--,m()}})())}}async function f(t){var a,l,d,u,m;let{type:f,payload:p,requestId:w}=t.data;switch(f){case"initialize":{let{cacheKey:t,pbkdf2Iterations:n,cacheBuster:a}=p;e=new TextEncoder().encode(t),r=n||1e5,o=new TextEncoder().encode(a).buffer,await i()}break;case"encrypt":{;let{value:e}=p;await (a=w,l=e,void h(async()=>{try{let e=await s(l);if(!n)throw Error("MessagePort is not available");n.postMessage({requestId:a,type:"encryptResult",result:e},[e.iv,e.ciphertext])}catch(t){console.error("Worker: Encryption error:",t);let e=t instanceof Error?t.message:"Unknown encryption error";n&&n.postMessage({requestId:a,type:"error",error:e})}}))}break;case"decrypt":{;let{iv:e,ciphertext:t}=p;await (d=w,u=e,m=t,void h(async()=>{try{let e=await c(u,m);if(!n)throw Error("MessagePort is not available");n.postMessage({requestId:d,type:"decryptResult",result:e})}catch(t){console.error("Worker: Decryption error:",t);let e=t instanceof Error?t.message:"Unknown decryption error";n&&n.postMessage({requestId:d,type:"error",error:e})}}))}break;case"destroy":e&&(e.fill(0),e=null),o&&(new Uint8Array(o).fill(0),o=null),n&&(n.close(),n=null),self.close();break;default:console.warn(`Worker: Unknown message type received: ${f}. Ignoring the message.`)}}self.onmessage=function(e){let{type:t}=e.data;"init"===t&&e.ports&&e.ports.length>0&&((n=e.ports[0]).onmessage=f,n.start())}}function q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let _=null===(a=crypto)||void 0===a?void 0:a.subtle;class H{async initWorker(e,t){if(this.workerReadyPromise)return this.workerReadyPromise;this.workerReadyPromise=new Promise((r,n)=>{var o,a,i,s;let{worker:c,port:d}=function(e,t){let r=new Blob([`(${e.toString()})()`],{type:"application/javascript"}),n=URL.createObjectURL(r),o=new Worker(n),a=new MessageChannel;return o.postMessage({type:"init"},[a.port2]),o.onmessage=()=>{URL.revokeObjectURL(n)},o.onerror=e=>{console.error("Worker encountered an error:",e.message),t("Worker encountered an error and was terminated."),o.terminate()},a.port1.onmessageerror=()=>{console.warn("MessagePort encountered a message error. Worker may have been terminated."),t("Worker was terminated unexpectedly."),a.port1.close()},{worker:o,port:a.port1}}(F,e=>{n(new h(e)),w(this.pendingRequests,e)});this.worker=c,this.port=d,o=d,a=r,i=n,s=this.pendingRequests,o.onmessage=e=>{let t=e.data;if("ready"===t.type)a();else if("initError"===t.type)i(new h(t.error)),w(s,t.error);else{var r,n,o;if("encryptResult"===(r=t).type&&"string"==typeof r.requestId){let{requestId:e,result:r}=t,n=s.get(e);n&&(clearTimeout(n.timer),n.resolve(r),s.delete(e))}else{;if("decryptResult"===(n=t).type&&"string"==typeof n.requestId){let{requestId:e,result:r}=t,n=s.get(e);n&&(clearTimeout(n.timer),n.resolve(r),s.delete(e))}else{;if("error"===(o=t).type&&"string"==typeof o.requestId){let{requestId:e,error:r}=t,n=s.get(e);if(n){let t;let o=r.toLowerCase();t=o.includes("encrypt")?new m(r):o.includes("decrypt")?new f(r):o.includes("key")?new u(r):new l(r),clearTimeout(n.timer),n.reject(t),s.delete(e)}}else console.warn("WorkerUtils: Unknown message type received. Ignoring the message.",t)}}}},o.onmessageerror=e=>{console.error("Worker encountered a message error:",e),i(new h("Worker failed to initialize")),w(s,"Worker encountered an error and was terminated."),o.close()},d.postMessage({type:"initialize",payload:{cacheKey:e,cacheBuster:t,pbkdf2Iterations:this.pbkdf2Iterations}})});try{await this.workerReadyPromise}catch(e){if(console.error("Worker failed to initialize:",e),e instanceof l)throw e;throw new h("Worker failed to initialize.")}}async cleanup(){try{let e=(await this.dbReadyPromise).transaction(this.storeName,"readwrite"),t=e.store,r=t.index("byTimestamp"),n=t.index("byCacheBuster"),o=Date.now(),a=await r.openCursor();for(;a;){let{timestamp:e}=a.value;if(e<=o){let t=o-e;this.debug&&console.debug(`Deleting expired item with timestamp ${e}. It is ${t}ms older than the expiration.`),await a.delete()}else break;a=await a.continue()}let i=this.cacheBuster,s=IDBKeyRange.upperBound(i,!0),c=IDBKeyRange.lowerBound(i,!0),l=async e=>{let t=0,r=await n.openCursor(e);for(;r;)this.debug&&console.debug("Deleting item with cacheBuster:",r.value.cacheBuster),await r.delete(),t++,r=await r.continue();return t},d=await Promise.all([l(s),l(c)]);if(void 0!==this.maxTotalChunks){let e=await t.count();if(e>this.maxTotalChunks){let t=e-this.maxTotalChunks;this.debug&&console.debug(`Total chunks (${e}) exceed maxTotalChunks (${this.maxTotalChunks}). Deleting ${t} oldest chunks.`);let n=0,o=await r.openCursor(null,"next");for(;o&&n<t;)await o.delete(),n++,o=await o.continue();this.debug&&console.debug(`Deleted ${n} oldest chunks to enforce maxTotalChunks.`)}else this.debug&&console.debug(`Total chunks (${e}) within maxTotalChunks (${this.maxTotalChunks}). No excess cleanup needed.`)}await e.done,this.debug&&d.reduce((e,t)=>e+(t||0),0)>0&&console.debug("Flushed old cache items with different cacheBuster.")}catch(e){if(console.error("Error during cleanup:",e),e instanceof d)throw e;throw new d("Failed to clean up the cache.")}}async ensureWorkerInitialized(){if(!this.workerReadyPromise)throw new h("Worker is not initialized.");await this.workerReadyPromise}getPort(){if(!this.port)throw new h("Worker port is not initialized.");return this.port}async getItem(e){try{let t=Date.now();if(!this.dbReadyPromise)return null;await this.ensureWorkerInitialized();let r=await this.dbReadyPromise,n=await K(`${this.cacheKey}:${e}`),o=Date.now(),a=await A(r,this.storeName,n);if(this.debug&&(0===a.length?console.debug(`Cache miss for key ${e}`):console.debug(`Cache hit for key ${e}`)),0===a.length)return null;let i=[];for(let t of a){let n=await r.get(this.storeName,t);if(!n)continue;if(n.timestamp<=o)return await this.removeItem(e),null;if(n.cacheBuster!==this.cacheBuster)continue;let a=function(e){let t=e.split("-chunk-");return t.length<2?-1:Number.parseInt(t[1].split("-")[0],10)}(t);i.push({index:a,data:n})}if(0===i.length)return null;i.sort((e,t)=>e.index-t.index);let s=await Promise.all(i.map(({data:{iv:e,ciphertext:t}})=>x(this.getPort(),e,t,this.pendingRequests))),c=Date.now()-t;return this.debug&&c>200&&console.debug(`getItem for key ${e} took ${c}ms`),s.join("")}catch(t){if(t instanceof f)throw console.error(`Decryption failed for key ${e}:`,t),t;if(t instanceof d)throw console.error(`Database error while getting key ${e}:`,t),t;if(t instanceof h)throw console.error(`Worker initialization error while getting key ${e}:`,t),t;if(t instanceof l)throw console.error(`IDBCache error while getting key ${e}:`,t),t;throw console.error(`Unexpected error while getting key ${e}:`,t),new l("An unexpected error occurred.")}}async setItem(e,t){try{let a=Date.now();if(!this.dbReadyPromise)return;await this.ensureWorkerInitialized();let i=await this.dbReadyPromise,s=await K(`${this.cacheKey}:${e}`),c=Date.now()+this.gcTime,l=await A(i,this.storeName,s),d=new Set(l),u=new Set,h=[],m=[];for(let e=0;e<t.length;e+=this.chunkSize){var r,n,o;let a=t.slice(e,e+this.chunkSize),l=Math.floor(e/this.chunkSize),f=await K(`${this.cacheKey}:${this.cacheBuster}:${a}`);let p=(r=s,n=l,o=f,`${r}-chunk-${String(n).padStart(6,"0")}-${o}`);if(u.add(p),d.has(p)){let e=await i.get(this.storeName,p);e&&e.timestamp!==c&&m.push({...e,timestamp:c,cacheBuster:this.cacheBuster})}else{let e=await g(this.getPort(),a,this.pendingRequests);h.push({chunkKey:p,encryptedChunk:{...e,cacheBuster:this.cacheBuster}})}}let f=l.filter(e=>!u.has(e)),p=i.transaction(this.storeName,"readwrite"),w=p.store,y=[];for(let e of m)y.push(w.put(e));for(let{chunkKey:e,encryptedChunk:t}of h)y.push(w.put({...t,key:e,timestamp:c}));for(let e of f)y.push(w.delete(e));await Promise.all(y),await p.done;let x=Date.now()-a;this.debug&&x>200&&console.debug(`setItem for key ${e} took ${x}ms`)}catch(e){if(e instanceof h)throw console.error("Worker port is not initialized:",e),e;if(e instanceof d)throw console.error("Database error in setItem:",e),e;if(e instanceof m)throw console.error("Encryption error in setItem:",e),e;if(e instanceof l)throw console.error("IDBCache error in setItem:",e),e;throw console.error("Unexpected error in setItem:",e),new l("An unexpected error occurred during setItem.")}}async removeItem(e){try{let t=await this.dbReadyPromise,r=await K(`${this.cacheKey}:${e}`),n=await A(t,this.storeName,r),o=t.transaction(this.storeName,"readwrite"),a=o.store,i=n.map(e=>a.delete(e));await Promise.all(i),await o.done}catch(e){if(console.error("Error in removeItem:",e),e instanceof d||e instanceof l)throw e;throw new d("Failed to remove item from the cache.")}}async count(){try{let e=(await this.dbReadyPromise).transaction(this.storeName,"readonly"),t=e.store,r=await t.count();return await e.done,this.debug&&console.debug(`Total entries in cache: ${r}`),r}catch(e){if(console.error("Error in count():",e),e instanceof d)throw e;throw new d("Failed to count items in the cache.")}}async clear(){try{let e=(await this.dbReadyPromise).transaction(this.storeName,"readwrite"),t=e.store;await t.clear(),await e.done,this.debug&&console.debug("All items have been cleared from the cache.")}catch(e){if(console.error("Error in clear:",e),e instanceof d||e instanceof l)throw e;throw new d("Failed to clear the cache.")}}async destroy(e){let{clearData:t=!1}=e||{};try{t&&await this.clear(),void 0!==this.cleanupIntervalId&&clearInterval(this.cleanupIntervalId),this.pendingRequests.forEach((e,t)=>{e.reject(new l("IDBCache instance is being destroyed.")),this.pendingRequests.delete(t)}),this.port&&(this.port.postMessage({type:"destroy"}),this.port.close(),this.port=null),this.worker&&(this.worker.terminate(),this.worker=null),this.workerReadyPromise=null,this.debug&&console.debug("IDBCache instance has been destroyed.")}catch(e){if(console.error("Error in destroy:",e),e instanceof l)throw e;throw new l("Failed to destroy the cache instance.")}}constructor(e){q(this,"dbReadyPromise",void 0),q(this,"storeName",void 0),q(this,"worker",null),q(this,"port",null),q(this,"pendingRequests",void 0),q(this,"workerReadyPromise",null),q(this,"gcTime",void 0),q(this,"cleanupIntervalId",void 0),q(this,"cacheKey",void 0),q(this,"chunkSize",void 0),q(this,"cleanupInterval",void 0),q(this,"pbkdf2Iterations",void 0),q(this,"cacheBuster",void 0),q(this,"debug",void 0),q(this,"maxTotalChunks",void 0);let{cacheKey:t,cacheBuster:r,debug:n=!1,dbName:o="idb-cache",gcTime:a=6048e5,chunkSize:i=25e3,cleanupInterval:s=6e4,pbkdf2Iterations:c=1e5,maxTotalChunks:l}=e;if(this.storeName="cache",this.cacheKey=t,this.cacheBuster=r,this.debug=n,this.gcTime=a,this.chunkSize=i,this.cleanupInterval=s,this.pbkdf2Iterations=c,this.maxTotalChunks=l,this.pendingRequests=new Map,!window.indexedDB)throw new d("IndexedDB is not supported.");if(!_)throw new u("Web Crypto API not available in this environment");this.dbReadyPromise=G(o,this.storeName,1),this.cleanupIntervalId=window.setInterval(async()=>{try{await this.cleanup()}catch(e){console.error("Error during cleanup:",e)}},this.cleanupInterval),this.initWorker(t,r).then(()=>{setTimeout(()=>{this.cleanup().catch(e=>console.error("Initial cleanup failed:",e))},1e4)}).catch(e=>{console.error("Worker initialization failed:",e)})}}var Y=r("2773"),Z=r.n(Y);function X(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return Math.abs(t).toString(36)}let J={};var Q=r("795"),ee=r("7934"),et=r("9719"),er=r("9839"),en=r("2462"),eo=r("4964");function ea(){return(0,i.jsxs)("a",{href:"https://github.com/instructure/idb-cache","aria-label":"View source on GitHub",children:[(0,i.jsxs)("svg",{width:80,height:80,viewBox:"0 0 250 250",style:{fill:"#151513",color:"#fff",position:"absolute",top:0,border:0,right:0},"aria-hidden":"true",children:[(0,i.jsx)("path",{d:"M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"}),(0,i.jsx)("path",{d:"M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2",fill:"currentColor",style:{transformOrigin:"130px 106px"},className:"octo-arm"}),(0,i.jsx)("path",{d:"M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z",fill:"currentColor",className:"octo-body"})]}),(0,i.jsx)("span",{style:{position:"absolute",left:"-9999px"},children:"View source on GitHub"})]})}function ei(){return(0,i.jsx)("span",{style:{color:"#ddd"},children:"------"})}var es=r("1625");function ec(e){let{cacheKey:t}=e;return(0,i.jsxs)(er.kC,{alignItems:"end",children:[(0,i.jsx)(er.kC.Item,{shouldGrow:!0,children:(0,i.jsx)(es.o,{renderLabel:"Cache key:",interaction:"disabled",defaultValue:t})}),(0,i.jsx)(er.kC.Item,{children:(0,i.jsx)(Q.z,{"aria-label":"Reset cache key",margin:"0 0 0 xxx-small","data-testid":"reset-cacheKey",onClick:()=>{localStorage.removeItem("cacheKey"),localStorage.removeItem("keyCounter"),window.location.reload()},children:"Reset"})})]})}function el(e){let{cacheBuster:t}=e;return(0,i.jsxs)(er.kC,{alignItems:"end",children:[(0,i.jsx)(er.kC.Item,{shouldGrow:!0,children:(0,i.jsx)(es.o,{renderLabel:"Cache buster:",interaction:"disabled",defaultValue:t})}),(0,i.jsx)(er.kC.Item,{children:(0,i.jsx)(Q.z,{"aria-label":"Reset cache buster",margin:"0 0 0 xxx-small","data-testid":"reset-cacheBuster",onClick:()=>{localStorage.removeItem("cacheBuster"),localStorage.removeItem("keyCounter"),window.location.reload()},children:"Reset"})})]})}function ed(e){let{children:t}=e;return(0,i.jsx)("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"flex-start",gap:"1.5rem"},children:t})}function eu(e){let{children:t}=e;return(0,i.jsx)("div",{style:{flex:"1 1 calc(50% - 1rem)",minWidth:"300px",boxSizing:"border-box"},children:t})}function eh(e){let{children:t}=e;return(0,i.jsx)(et.G,{as:"div",display:"block",margin:"small none",padding:"medium",background:"primary",shadow:"resting",children:(0,i.jsx)(er.kC,{direction:"column",children:t})})}let em=localStorage.cacheKey;!em&&(em=crypto.randomUUID(),localStorage.cacheKey=em);let ef=localStorage.cacheBuster;!ef&&(ef=crypto.randomUUID(),localStorage.cacheBuster=ef);let ep=()=>{let e=Number.parseInt(new URLSearchParams(window.location.hash.slice(1)).get("size")??"0",10);return!Number.isNaN(e)&&e>0?1024*e:32768},ew=document.getElementById("root");ew&&c.createRoot(ew).render((0,i.jsx)(s.StrictMode,{children:(0,i.jsx)(()=>{let[e,t]=(0,s.useState)(null),[r,n]=(0,s.useState)(null),[o,a]=(0,s.useState)(null),[c,l]=(0,s.useState)(null),[d,u]=(0,s.useState)(null),[h,m]=(0,s.useState)(null),[f,p]=(0,s.useState)(null),[w,y]=(0,s.useState)(null),[g,x]=(0,s.useState)(ep()),[b,k]=(0,s.useState)(25e3),[j,v]=(0,s.useState)(null),[I,C]=(0,s.useState)(()=>{let e=localStorage.getItem("maxTotalChunksStored");return e?Number.parseInt(e,10):5e3}),[S,E]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=new URLSearchParams(window.location.hash.slice(1));e.set("size",String(Math.round(g/1024))),window.location.hash=`#${e.toString()}`},[g]);let B=(0,s.useRef)(Number.parseInt(localStorage.getItem("keyCounter")||"0")||0),[D,M]=(0,s.useState)(()=>X(`seed-${B.current}`)),$=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=!1;return(async()=>{if($.current){E(!1);try{await $.current.destroy()}catch(e){console.error("Error destroying previous cache:",e)}}try{let t=new H({cacheKey:em,cacheBuster:ef,debug:!0,chunkSize:b,maxTotalChunks:I});e?await t.destroy():($.current=t,E(!0))}catch(t){console.error("Error initializing cache:",t),!e&&E(!1)}})(),()=>{e=!0,$.current&&($.current.destroy().catch(e=>{console.error("Error destroying cache on cleanup:",e)}),$.current=null,E(!1))}},[b,I]),(0,s.useEffect)(()=>{localStorage.setItem("maxTotalChunksStored",String(I))},[I]);let z=(0,s.useCallback)(async()=>{let e=$.current;if(!e){console.error("Cache is not initialized.");return}let r=X(`seed-${B.current}`);localStorage.setItem("keyCounter",String(B.current)),B.current+=1,M(r);let n=performance.now(),o=Array.from({length:1},(e,t)=>(function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",n=`${e}-${r}`;if(J[n])return J[n];let o=Z().create(r),a=Math.ceil(e),i=Array(a);for(let e=0;e<a;e++)i[e]=String.fromCharCode(33+Math.floor(94*o.random()));let s=i.join("");for(;t=s,new TextEncoder().encode(t).length>e;)s=s.slice(0,-1);return J[n]=s,s})(g,`${r}-${t}`));a(performance.now()-n);let i=performance.now();for(let t=0;t<1;t++)await e.setItem(`item-${r}-${t}`,o[t]);l(performance.now()-i),t(X(o.join("")))},[g]),P=(0,s.useCallback)(async()=>{let e=$.current;if(!e){console.error("Cache is not initialized.");return}let t=[],r=performance.now();for(let r=0;r<1;r++){let n=await e.getItem(`item-${D}-${r}`);t.push(n)}u(performance.now()-r),n(t.filter(e=>e).length>0?X(t.join("")):null)},[D]),R=(0,s.useCallback)(async()=>{let e=$.current;if(!e){console.error("Cache is not initialized.");return}let t=performance.now();await e.cleanup(),p(performance.now()-t)},[]),T=(0,s.useCallback)(async()=>{let e=$.current;if(!e){console.error("Cache is not initialized.");return}let t=performance.now(),r=await e.count();m(performance.now()-t),v(r)},[]),L=(0,s.useCallback)(async()=>{let e=$.current;if(!e){console.error("Cache is not initialized.");return}let t=performance.now();await e.clear(),localStorage.removeItem("keyCounter"),y(performance.now()-t)},[]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(ea,{}),(0,i.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,i.jsxs)(et.G,{as:"div",display:"block",width:"820px",margin:"0 auto",children:[(0,i.jsx)("h1",{style:{fontSize:"clamp(1.8rem, 4vw, 2.4rem)",whiteSpace:"nowrap",marginBottom:"1rem"},children:"@instructure/idb-cache"}),(0,i.jsxs)("form",{children:[(0,i.jsxs)(ed,{children:[(0,i.jsx)(eu,{children:(0,i.jsx)(ec,{cacheKey:em})}),(0,i.jsx)(eu,{children:(0,i.jsx)(el,{cacheBuster:ef})}),(0,i.jsx)(eu,{children:(0,i.jsx)(eo.Y,{renderLabel:"Size of item (KB):",onChange:e=>{x(Math.max(1024*Number.parseInt(e.target.value,10),1024))},onIncrement:()=>{x(e=>Math.max(e+1024,1024))},onDecrement:()=>{x(e=>Math.max(e-1024,1024))},isRequired:!0,value:Math.round(g/1024)})}),(0,i.jsx)(eu,{children:(0,i.jsx)(eo.Y,{renderLabel:"Chunks per item:",interaction:"disabled",value:Math.ceil(g/b)})}),(0,i.jsx)(eu,{children:(0,i.jsx)(eo.Y,{disabled:!0,renderLabel:"Chunk size (KB):",onChange:e=>{k(Math.max(1024*Number.parseInt(e.target.value,10),1024))},onIncrement:()=>{k(e=>Math.max(e+1024,1024))},onDecrement:()=>{k(e=>Math.max(e-1024,1024))},value:Math.round(b/1024)})}),(0,i.jsx)(eu,{children:(0,i.jsx)(eo.Y,{renderLabel:"Max total chunks:",onChange:e=>{C(Number.parseInt(e.target.value,10)||1)},onIncrement:()=>{C(e=>Math.max(e+1,1))},onDecrement:()=>{C(e=>Math.max(e-1,1))},value:I})})]}),(0,i.jsx)(en.X,{level:"h2",margin:"medium 0 small 0",children:"Tests"}),(0,i.jsxs)(eh,{children:[(0,i.jsx)(Q.z,{"data-testid":"set-item-button",color:"primary",onClick:z,disabled:!S,children:"setItem"}),(0,i.jsx)(et.G,{padding:"medium 0 0 0",children:(0,i.jsxs)(er.kC,{children:[(0,i.jsx)(er.kC.Item,{size:"33.3%",children:(0,i.jsx)(ee.j,{renderLabel:"fixtures","data-testid":"generate-time",renderValue:null!==o?`${Math.round(o)} ms`:(0,i.jsx)(ei,{})})}),(0,i.jsx)(er.kC.Item,{shouldGrow:!0,children:(0,i.jsx)(ee.j,{renderLabel:"setItem","data-testid":"set-time",renderValue:null!==c?`${Math.round(c)} ms`:(0,i.jsx)(ei,{})})}),(0,i.jsx)(er.kC.Item,{size:"33.3%",children:(0,i.jsx)(ee.j,{"data-testid":"hash1",renderLabel:"hash",renderValue:e||(0,i.jsx)(ei,{})})})]})})]}),(0,i.jsxs)(eh,{children:[(0,i.jsx)(Q.z,{"data-testid":"get-item-button",color:"primary",onClick:P,disabled:!S,children:"getItem"}),(0,i.jsx)(et.G,{padding:"medium 0 0 0",children:(0,i.jsxs)(er.kC,{children:[(0,i.jsx)(er.kC.Item,{size:"33.3%",children:"\xa0"}),(0,i.jsx)(er.kC.Item,{shouldGrow:!0,children:(0,i.jsx)(ee.j,{renderLabel:"getItem","data-testid":"get-time",renderValue:null!==d?`${Math.round(d)} ms`:(0,i.jsx)(ei,{})})}),(0,i.jsx)(er.kC.Item,{size:"33.3%",children:(0,i.jsx)(ee.j,{renderLabel:"hash","data-testid":"hash2",renderValue:r||(0,i.jsx)(ei,{})})})]})})]}),(0,i.jsxs)(eh,{children:[(0,i.jsx)(Q.z,{"data-testid":"count-button",color:"primary",onClick:T,disabled:!S,children:"count"}),(0,i.jsx)(et.G,{padding:"medium 0 0 0",children:(0,i.jsxs)(er.kC,{children:[(0,i.jsx)(er.kC.Item,{size:"33.3%",children:"\xa0"}),(0,i.jsx)(er.kC.Item,{shouldGrow:!0,children:(0,i.jsx)(ee.j,{renderLabel:"count","data-testid":"count-time",renderValue:null!==h?`${Math.round(h)} ms`:(0,i.jsx)(ei,{})})}),(0,i.jsx)(er.kC.Item,{size:"33.3%",children:(0,i.jsx)(ee.j,{renderLabel:"chunks","data-testid":"count-value",renderValue:"number"==typeof j?j:(0,i.jsx)(ei,{})})})]})})]}),(0,i.jsxs)(eh,{children:[(0,i.jsx)(Q.z,{"data-testid":"cleanup-button",color:"primary",onClick:R,disabled:!S,children:"cleanup"}),(0,i.jsx)(et.G,{padding:"medium 0 0 0",children:(0,i.jsxs)(er.kC,{children:[(0,i.jsx)(er.kC.Item,{size:"33.3%",children:"\xa0"}),(0,i.jsx)(er.kC.Item,{shouldGrow:!0,children:(0,i.jsx)(ee.j,{renderLabel:"cleanup","data-testid":"cleanup-time",renderValue:null!==f?`${Math.round(f)} ms`:(0,i.jsx)(ei,{})})}),(0,i.jsx)(er.kC.Item,{size:"33.3%",children:"\xa0"})]})})]}),(0,i.jsxs)(eh,{children:[(0,i.jsx)(Q.z,{"data-testid":"clear-button",color:"primary",onClick:L,disabled:!S,children:"clear"}),(0,i.jsx)(et.G,{padding:"medium 0 0 0",children:(0,i.jsxs)(er.kC,{children:[(0,i.jsx)(er.kC.Item,{size:"33.3%",children:"\xa0"}),(0,i.jsx)(er.kC.Item,{shouldGrow:!0,children:(0,i.jsx)(ee.j,{renderLabel:"clear","data-testid":"clear-time",renderValue:null!==w?`${Math.round(w)} ms`:(0,i.jsx)(ei,{})})}),(0,i.jsx)(er.kC.Item,{size:"33.3%",children:"\xa0"})]})})]})]})]})})]})},{})}))}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}r.m=e,r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};r.t=function(n,o){if(1&o&&(n=this(n)),8&o||"object"==typeof n&&n&&(4&o&&n.__esModule||16&o&&"function"==typeof n.then))return n;var a=Object.create(null);r.r(a);var i={};e=e||[null,t({}),t([]),t(t)];for(var s=2&o&&n;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach(function(e){i[e]=function(){return n[e]}});return i.default=function(){return n},r.d(a,i),a}})(),r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=[];r.O=function(t,n,o,a){if(n){a=a||0;for(var i=e.length;i>0&&e[i-1][2]>a;i--)e[i]=e[i-1];e[i]=[n,o,a];return}for(var s=1/0,i=0;i<e.length;i++){for(var n=e[i][0],o=e[i][1],a=e[i][2],c=!0,l=0;l<n.length;l++)(!1&a||s>=a)&&Object.keys(r.O).every(function(e){return r.O[e](n[l])})?n.splice(l--,1):(c=!1,a<s&&(s=a));if(c){e.splice(i--,1);var d=o();void 0!==d&&(t=d)}}return t}})(),r.rv=function(){return"1.1.1"},(()=>{var e={980:0};r.O.j=function(t){return 0===e[t]};var t=function(t,n){var o=n[0],a=n[1],i=n[2],s,c,l=0;if(o.some(function(t){return 0!==e[t]})){for(s in a)r.o(a,s)&&(r.m[s]=a[s]);if(i)var d=i(r)}for(t&&t(n);l<o.length;l++)c=o[l],r.o(e,c)&&e[c]&&e[c][0](),e[c]=0;return r.O(d)},n=self.webpackChunkidb_cache_app=self.webpackChunkidb_cache_app||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),r.ruid="bundler=rspack@1.1.1";var n=r.O(void 0,["361","437"],function(){return r("9427")});n=r.O(n)})();